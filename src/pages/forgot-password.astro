---
import AuthLayout from "@/layouts/AuthLayout.astro";
import { ForgotPasswordForm } from "@/components/auth/ForgotPasswordForm";
import { createSupabaseServerInstance } from "@/db/supabase.client";

// Check if user is already authenticated
// Since /forgot-password is a public route, we need to manually check the session
const supabase = createSupabaseServerInstance({
  headers: Astro.request.headers,
  cookies: Astro.cookies,
});

const {
  data: { user },
} = await supabase.auth.getUser();

if (user) {
  return Astro.redirect("/");
}
---

<AuthLayout title="Forgot Password - SEO Query Insights Dashboard">
  <div class="space-y-6">
    <div class="space-y-2">
      <h2 class="text-2xl font-semibold text-foreground">Reset your password</h2>
      <p class="text-sm text-muted-foreground">We'll send you a link to reset your password</p>
    </div>

    <ForgotPasswordForm client:load />
  </div>
</AuthLayout>
